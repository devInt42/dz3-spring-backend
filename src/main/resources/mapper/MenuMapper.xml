<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.mapper.MenuMapper">
	<resultMap id="menuMap"
		type="com.example.backend.dto.MenuDto">
		<result property="menuSeq" column="menu_seq"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="menuCode" column="menu_code"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="menuName" column="menu_name"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="menuParent" column="menu_parent"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="menuDepth" column="menu_depth"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="child" column="child"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
	</resultMap>

	<!-- 깊이별 메뉴 조회 -->
	<select id="getChildListByDepth"
		parameterType="com.example.backend.dto.MenuDto" resultMap="menuMap">
		select
		menu_seq, menu_code, menu_name,
		menu_parent, menu_depth
		from menu
		where
		menu_depth = #{menuDepth}
		and
		menu_parent =
		#{menuParent}
	</select>

	<!-- 깊이별 메뉴 조회 -->
	<select id="getCountListByDepth"
		parameterType="com.example.backend.dto.MenuDto" resultType="int">
		select
		count(*)
		from menu
		where
		menu_depth = #{menuDepth}
		and
		menu_parent = #{menuParent}
	</select>

	<!-- 메뉴리스트 조회 -->
	<select id="getMenuList" resultMap="menuMap">
		select * from menu where
		menu_parent = 0
	</select>

	<!-- 하위메뉴 조회 -->
	<select id="getSubMenuList" parameterType="Integer"
		resultMap="menuMap">
		select * from menu where menu_parent = #{menuSequence}
	</select>

	<!-- 상위메뉴 깊이 조회 -->
	<select id="getParentDepth" parameterType="String"
		resultType="Integer">
		select distinct menu_depth from menu where menu_id =
		#{menuParent}
	</select>

	<!-- 메뉴 저장 -->
	<insert id="insertMenu">
		insert into menu (menu_id, menu_name,
		menu_parent,
		menu_depth) VALUES(#{menuId}, #{menuName}, #{menuParent},
		#{menuDepth})
	</insert>
</mapper>