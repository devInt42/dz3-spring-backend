<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.mapper.AuthEmployeeMapper">
	<resultMap id="authEmployeeMap"
		type="com.example.backend.dto.mapping.AuthEmployeeDto">
		<result property="authSeq" column="auth_seq"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="employeeSeq" column="employee_seq"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="workplaceSeq" column="workplace_seq"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="departmentSeq" column="department_seq"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="companySeq" column="company_seq"
			javaType="java.lang.Integer" jdbcType="INTEGER" />
		<result property="authName" column="auth_name"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="companyName" column="company_name"
			javaType="java.lang.String" jdbcType="VARCHAR" />
		<result property="authCode" column="auth_code"
			javaType="java.lang.String" jdbcType="VARCHAR" />
	</resultMap>

	<select id="getAuthListByCompany"
		parameterType="com.example.backend.dto.mapping.AuthEmployeeDto"
		resultMap="authEmployeeMap">
		SELECT distinct
		res.auth_seq, res.workplace_seq,
		res.department_seq, c.company_seq, res.auth_name, c.company_name,
		res.auth_code
		from
		(SELECT
		a.auth_seq, r1.employee_seq, r1.workplace_seq, r1.company_seq,
		r1.department_seq, a.auth_name, a.auth_code
		FROM
		auth a JOIN
		auth_employee r1
		ON
		a.auth_seq = r1.auth_seq) res
		JOIN company c
		ON
		res.company_seq = c.company_seq
		WHERE
		c.company_seq = #{companySeq}
		LIMIT #{startPgNum},#{endPgNum}
	</select>

</mapper> 